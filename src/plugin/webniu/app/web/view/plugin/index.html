<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <title>应用插件</title>
    <link rel="stylesheet" href="/app/webniu/skins/component/pear/css/pear.css" />
    <link rel="stylesheet" href="/app/webniu/skins/admin/css/admin.css" />
    <link rel="stylesheet" href="/app/webniu/skins/admin/css/variables.css" />
    <link rel="stylesheet" href="/app/webniu/skins/admin/css/reset.css" />
</head>

<body>

    <div class="pear-container">
        <!-- 顶部查询表单 -->
        <div class="layui-card">
            <div class="layui-card-body">
                <form class="layui-form top-search-from">

                    <div class="layui-form-item">
                        <label class="layui-form-label">类型</label>
                        <div class="layui-input-block">
                            <div name="plugin_type" id="plugin_type" value=""></div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">分类</label>
                        <div class="layui-input-block">
                            <div name="plugin_class" id="plugin_class" value=""></div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">名称</label>
                        <div class="layui-input-block">
                            <input type="hidden" name="plugin_name[]" value="like" class="layui-input">
                            <input type="text" name="plugin_name[]" value="" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item layui-inline">
                        <label class="layui-form-label"></label>
                        <div class="layui-btn-container">
                        <button class="layui-btn layui-btn-sm" lay-submit lay-filter="table-query">
                            <i class="layui-icon layui-icon-search"></i>查询
                        </button>
                        <button type="reset" class="layui-btn layui-btn-sm layui-btn-primary" lay-submit lay-filter="table-reset">
                            <i class="layui-icon layui-icon-refresh"></i>重置
                        </button>
                        </div>
                    </div>
                    <div class="toggle-btn">
                        <a class="layui-hide">展开<i class="layui-icon layui-icon-down"></i></a>
                        <a class="layui-hide">收起<i class="layui-icon layui-icon-up"></i></a>
                    </div>
                </form>
            </div>
        </div>

        <!-- 数据表格 -->
        <div class="layui-card">
            <div class="layui-card-body">
                <table id="data-table" lay-filter="data-table"></table>
            </div>
        </div>
    </div>
    <style>
        .images-container{
            max-width:32px;
            max-height: 32px;
            background-color: #ffffff;
            position: absolute;
            margin: 4px 0px 0px -8%;
        } 
        .pointer_style{
            margin-left: 5px;
            cursor: pointer;
        }
        .plugin_btn .layui-btn-plugin{
            background-color: rgb(from var(--global-primary-color) r g b /20%);
            color: rgb(from var(--global-primary-color) r g b /80%);
        }
        .layui-field-box-fie{
            position: relative;
        }
        .layui-field-box-img{
            position: absolute;
            top: 0px;
            right: 10px;
        }
    </style>


    <script src="/app/webniu/skins/component/layui/layui.js"></script>
    <script src="/app/webniu/skins/component/pear/pear.js"></script>
    <script src="/app/webniu/skins/admin/js/permission.js"></script>
    <script src="/app/webniu/skins/admin/js/common.js"></script>
    <script>

        // 表格渲染
        layui.use(["table", "form", "common", "popup", "util", "drawer", "xmSelect", "jquery","nprogress","toast","laytpl"], function () {

            // 相关常量
            let PRIMARY_KEY     = "id";
            let SELECT_API      = "/app/webniu/web/plugin/select"; 
            let WAITAPPS_API    = "/app/webniu/web/plugin/waitapps";
            let LOCALAPPS_API   = "/app/webniu/web/plugin/localapps";
            let UNINSTALL_API   = "/app/webniu/web/plugin/uninstall";
            let INSTALL_URL     = "/app/webniu/web/plugin/install";
            let UPDATE_URL      = "/app/webniu/web/plugin/update";
            let REG_API         = "/app/webniu/web/plugin/reg";
            let LOGIN_API       = "/app/webniu/web/plugin/login";
            let OUT_API         = "/app/webniu/web/plugin/out";
            let WNYUN_API       = "/app/webniu/web/plugin/wnyun";
            let apiResults      = {};
            let nprogress   = parent.layui.nprogress;
            let table       = layui.table;
            let toast       = parent.layui.toast;
            let layer       = layui.layer;
            let form        = layui.form;
            let $           = layui.$;
            let common      = layui.common;
            let util        = layui.util;
            let drawer      = layui.drawer;
            let laytpl      = layui.laytpl;
            let updatedate  = {};
            let colsone     = {
                title: "图标",
                field: "plugin_logo",
                align: "center",
                templet: function (d) {
                    let field = "plugin_logo";
                    if (typeof d[field] == "undefined") return "";
                    let items = [];
                    let html = '';
                    layui.each((d[field] + "").split(","), function (k, v) {
                        html += '<img src="' + encodeURI(v) + '" class="images-container" alt="" />';
                    });
                    return html;
                }
            };
            layui.$.ajax({
                url: "/app/webniu/web/plugin/typeclass",
                dataType: "json",
                success: function (res) {
                    if (res.code) {
                        layui.popup.failure(res.msg);
                    }
                    layui.xmSelect.render({
                        el: "#plugin_type",
                        name: "plugin_type",
                        initValue: [],
                        data: res.data.plugin_type??[],
                        theme: {color: localStorage.getItem("theme-color-color")},
                        model: { "icon": "hidden", "label": { "type": "text" } },
                        clickClose: true,
                        radio: true,
                    });
                    layui.xmSelect.render({
                        el: "#plugin_class",
                        name: "plugin_class",
                        initValue: [],
                        data: res.data.plugin_class??[],
                        theme: {color: localStorage.getItem("theme-color-color")},
                        model: { "icon": "hidden", "label": { "type": "text" } },
                        clickClose: true,
                        radio: true,
                    });
                    apiResults["plugin_type"] = res.data.plugin_type ?? [];
                    apiResults["plugin_class"] = res.data.plugin_class ?? [];
                    render();

                }
            });
            // 表头参数
            let cols = [
                colsone,{
                    title: "名称",
                    field: "plugin_name",
                }, {
                    title: "类别",
                    field: "plugin_type",
                    templet: function (d) {
                        let field = "plugin_type";
                        if (typeof d[field] == "undefined") return "";
                        let value = d[field];
                        let found = $.map(apiResults[field], function (item) {
                            if (item.value === value) {
                                return item.name;
                            }
                        });
                        return found;
                    }
                }, {
                    title: "分类",
                    field: "plugin_class",
                    templet: function (d) {
                        let field = "plugin_class";
                        if (typeof d[field] == "undefined") return "";
                        let value = d[field];
                        let found = $.map(apiResults[field], function (item) {
                            if (item.value == value) {
                                return item.name;
                            }
                        });
                        return found;
                    }
                }, {
                    title: "描述",
                    field: "plugin_desc",
                }, {
                    title: "标识",
                    field: "plugin_identifier",
                }, {
                    title: "版本号",
                    align: "center",
                    field: "version",
                    templet: function (d) {
                        return '<div class="version_'+d['plugin_identifier']+'">'+d['version']+'</div>';
                    }
                }, {
                    title: "安装时间",
                    field: "created_at",
                    hide: true,
                }, {
                    title: "操作",
                    toolbar: "#table-bar",
                    align: "center",
                    fixed: "right",
                    width: 170,
                }
            ];

            // 渲染表格
            function render() {
                nprogress.start();
                table.render({
                    elem: "#data-table",
                    url: SELECT_API,
                    page: true,
                    cols: [cols],
                    skin: "line",
                    size: "lg", 
                    installedtype: 'installed',
                    toolbar: "#table-toolbar",
                    autoSort: false,
                    defaultToolbar: [{ // 右上角工具图标
                        title: '登录网牛云',
                        layEvent: 'LAYTABLE_TIPS',
                        icon: 'layui-icon-username',
                        onClick: function(obj) {
                            ajaxwnyun();
                        }
                    },{
                        title: "刷新",
                        layEvent: "refresh",
                        icon: "layui-icon-refresh",
                    }],
                    done: function (res) {
                        nprogress.done();
                        let thisOptions = this; 
                        if(thisOptions.installedtype=='installed'){
                            getversion(res.data);
                        } 
                         
                    }
                });
            }



            // 编辑或删除行事件
            table.on("tool(data-table)", function (obj) {
                if (obj.event === "remove") {
                    remove(obj);
                } else if (obj.event === "edit") {
                    edit(obj);
                } else if (obj.event === "installed") { 
                    installed(obj.data);
                } else if (obj.event === "update") { 
                    update(obj.data);
                } else if (obj.event === "details"){
                    details(obj.data);
                }

                 
            });

            // 表格顶部工具栏事件
            table.on("toolbar(data-table)", function (obj) {
                if (obj.event === "installed") {
                    installist(obj);
                } else if (obj.event === "waitapps") {
                    waitapps(obj);
                } else if (obj.event === "localapps") {
                    localapps(obj);
                } else if (obj.event === "refresh") {
                    refreshTable();
                }
            });

            // 表格顶部搜索事件
            form.on("submit(table-query)", function (data) {
                table.reload("data-table", {
                    page: {
                        curr: 1
                    },
                    where: data.field
                })
                return false;
            });

            // 表格顶部搜索重置事件
            form.on("submit(table-reset)", function (data) {
                table.reload("data-table", {
                    where: []
                })
            });

            
            let installist = function (obj) { 
                render();
            }
            let waitapps = function (obj) {
                nprogress.start();
                let cols_wait  = [...cols];
                cols_wait.splice(6, 0,{
                    title: "更新详情",
                    field: "details",
                    align: "center",
                    templet: function (d) {
                        let field = "details";
                        if (typeof d[field] == "undefined") return "";
                        return '<span class="layui-badge layui-bg-gray" lay-event="details">点击查看</span>';
                    }
                });
                table.render({
                    elem: "#data-table",
                    url: WAITAPPS_API,
                    page: true,
                    cols: [cols_wait],
                    skin: "line",
                    size: "lg", 
                    installedtype: 'waitapps',
                    toolbar: "#table-toolbar",
                    autoSort: false,
                    defaultToolbar: [{ // 右上角工具图标
                        title: '登录网牛云',
                        layEvent: 'LAYTABLE_TIPS',
                        icon: 'layui-icon-username',
                        onClick: function(obj) { // 2.9.12+
                            ajaxwnyun();
                        }
                    },{
                        title: "刷新",
                        layEvent: "refresh",
                        icon: "layui-icon-refresh",
                    }],
                    done: function (res) {
                        nprogress.done(); 
                    }
                });
            }
            let details = function(obj){
                let data = updatedate[obj.plugin_identifier];
                let details = obj.details??(data.details??false);
                if(details){
                    layer.open({
                        type: 2,
                        title: false,
                        shade: 0.1,
                        area: [common.isModile()?"100%":"650px", common.isModile()?"100%":"450px"],
                        content: details
                    });
                }
            }
            let localapps = function (obj) {
                nprogress.start();
                let cols_local  = [...cols];
                cols_local[0]   = {
                    title: "图标",
                    field: "plugin_logo",
                    align: "center",
                    templet: function (d) {
                        return '<i class="layui-icon layui-icon-app" style="font-size: 24px;"></i>';
                    }
                };
                table.render({
                    elem: "#data-table",
                    url: LOCALAPPS_API,
                    page: true,
                    cols: [cols_local],
                    skin: "line",
                    size: "lg", 
                    installedtype: 'localapps',
                    toolbar: "#table-toolbar",
                    autoSort: false,
                    defaultToolbar: [{
                        title: "刷新",
                        layEvent: "refresh",
                        icon: "layui-icon-refresh",
                    }],
                    done: function (res) {
                        nprogress.done(); 
                    }
                });
            }
            let installed = function(data){
                    layer.confirm("确定要安装?", {
                        icon: 3,
                        title: "提示"
                    }, function(index) { 
                        let loading = layer.load();
                        $.ajax({
                            url: INSTALL_URL,
                            type: "POST",
                            dataType: "json",
                            data:data,
                            success: function (res) {
                                layer.close(loading);
                                if (res.code === 0) {
                                    return toast.success({message:'安装成功',position: 'topCenter',onOpened:function(){
                                        parent.location.reload();
                                    }}); 
                                }
                                return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){}});
                            },
                            complete: function () {
                                layer.close(index);
                            }
                        });
                    });
                }
            let ajaxwnyun = function(){
                wnyun();
            }
            let wnyun = function(){
                let loading = layer.load();
                $.ajax({
                    url: WNYUN_API,
                    type: "POST",
                    dataType: "json",
                    data:{},
                    success: function (res) {
                        layer.close(loading);

                        if(res.code){
                            return login();
                        }
                        return laytpl($('#html-dom-wnyun').html()).render(res.data, function(html) {
                            layer.open({
                                type: 1,
                                area: '350px',
                                resize: false,
                                shadeClose: true,
                                title: '会员信息',
                                content:html,
                                success: function(){
                                    form.render();
                                }
                            }); 
                        });
                    }
                });
                 
                
                 
            }
            
            let login = function(){
                return laytpl($('#html-dom-login').html()).render({
                    'time':new Date().getTime()
                }, function(html) {
                    layer.open({
                        type: 1,
                        area: '350px',
                        resize: false,
                        shadeClose: true,
                        title: '登录网牛云',
                        content: html,
                        success: function(layero, index){
                            switchCaptcha();
                            form.render();
                            form.on('submit(demo-login)', function(data){
                                var field = data.field; 
                                let loading = layer.load();
                                $.ajax({
                                    url: LOGIN_API,
                                    type: "POST",
                                    dataType: "json",
                                    data:field,
                                    success: function (res) {
                                        layer.close(loading);
                                        if (res.code) {
                                            return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){
                                                switchCaptcha();
                                            }});
                                        }
                                        return toast.success({message:'登录成功',position: 'topCenter',onOpened:function(){layer.close(index);refreshTable();}}); 
                                    }
                                });
                                return false; // 阻止默认 form 跳转
                            });
                        }
                    }); 
                });
            }
            //注册方法  注册方法
            let reg = function(){
                return layer.open({
                    type: 1,
                    area: '350px',
                    resize: false,
                    shadeClose: true,
                    title: '注册网牛云',
                    content: $('#html-dom-reg').html(),
                    success: function(layero, index){
                        switchCaptcha();
                        form.render();
                        form.on('submit(demo-reg)', function(data){
                            var field = data.field; // 获取表单字段值
                            if(field.password != field.confirmPassword){
                                return toast.error({message:'两次密码不一致',position: 'topCenter',onOpened:function(){}});
                            }
                            let loading = layer.load();
                            $.ajax({
                                url: REG_API,
                                type: "POST",
                                dataType: "json",
                                data:field,
                                success: function (res) {
                                    layer.close(loading);
                                    if (res.code) {
                                        return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){
                                            switchCaptcha();
                                        }});
                                    }
                                    return toast.success({message:'注册成功',position: 'topCenter',onOpened:function(){layer.close(index);login();}}); 

                                }
                            });
                             
                            return false; // 阻止默认 form 跳转
                        });
                    }
                });
            }
            // 自定义验证规则
            form.verify({
                confirmPassword: function(value) {
                    if (value !== $('#reg-password').val()) {
                        return '两次密码不一致';
                    }
                },
                nickname: function(value){
                    if(value.length < 2 || value.length > 10){
                        return '昵称长度为2-10位';
                    }
                }
            });
            util.on('lay-on', {
                reg: function(){
                    layer.closeAll();
                    reg();
                },
                login: function(){
                    layer.closeAll();
                    login();
                },
                out: function(){
                    layer.confirm("确定要退出登录?", {
                        icon: 3,
                        title: "提示"
                    }, function(index) { 
                        layer.close(index);
                        let loading = layer.load();
                        $.ajax({
                            url: OUT_API,
                            type: "POST",
                            dataType: "json",
                            data:{'type':'logout'},
                            success: function (res) {
                                layer.close(index);
                                layer.close(loading);
                                if (res.code) {
                                    return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){}});
                                }
                                return toast.success({message:'退出登录',position: 'topCenter',onOpened:function(){layer.closeAll();refreshTable();}});
                            }
                        });
                         
                    });
                },
                //刷新验证码
                refreshCaptcha: function () {
                    switchCaptcha();
                }
            });
            // 表格编辑数据
            let edit = function (obj) {
                let value = obj.data[PRIMARY_KEY];

                drawer.open({
                    legacy: false,
                    title: ['配置', 'font-size:16px;color:#2d8cf0'],
                    offset: 'r',
                    area: [common.isModile() ? "100%" : "40%", common.isModile() ? "100%" : "100%"],
                    maxmin: false,
                    closeBtn: 1,
                    iframe: UPDATE_URL + "?" + PRIMARY_KEY + "=" + value
                });
            }

            let update = function (obj) {
                let data = updatedate[obj.plugin_identifier];
                if(data.islogin===0){
                    return login();
                }
                data['installedtype'] = data.installedtype??'localapps';
                layer.confirm("确定要升级?", {
                    icon: 3,
                    title: "提示"
                }, function(index) { 
                    let loading = layer.load();
                    $.ajax({
                        url: INSTALL_URL,
                        type: "POST",
                        dataType: "json",
                        data:data,
                        success: function (res) {
                            layer.close(loading);
                            if (res.code === 0) {
                                return toast.success({message:'升级成功',position: 'topCenter',onOpened:function(){
                                    parent.location.reload();
                                }});
                            }
                            return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){}}); 
                        },
                        complete: function () {
                            layer.close(index);
                        }
                    });
                });
            }
             

            // 删除一行
            let remove = function (obj) {
                return doRemove(obj.data[PRIMARY_KEY]);
            }
            function switchCaptcha() {
                var captcha = $('input[name="captcha"]');
                captcha.val('');
                $('.codeImage').attr("src", "/app/webniu/web/plugin/captcha?v=" + new Date().getTime());
            }
            
            // 执行删除
            let doRemove = function (ids) {
                let data = {};
                data[PRIMARY_KEY] = ids;
                layer.confirm("确定卸载?", {
                    icon: 3,
                    title: "提示"
                }, function (index) { 
                    let loading = layer.load(); 
                    $.ajax({
                        url: UNINSTALL_API,
                        data: data,
                        dataType: "json",
                        type: "post",
                        success: function (res) {
                            layer.close(loading);
                            if (res.code) {
                                return toast.error({message:res.msg,position: 'topCenter',onOpened:function(){}});
                            }
                            return toast.success({message:'卸载成功',position: 'topCenter',onOpened:function(){
                                parent.location.reload();
                            }});
                        },
                        complete: function () {
                            layer.close(index);
                        }
                    })
                });
            }

            function getversion(arr){
                let version = arr.map(item => ({
                    'name': item.plugin_identifier,
                    'version': item.version
                }));
                layui.$.ajax({
                    url: "/app/webniu/web/plugin/version", 
                    data:{version},
                    type: "POST",
                    dataType: "json",
                    cache: true,
                    success: function (res) { 
                        updatedate = res.data;
                        $.each(res.data,function(k,v){
                            $('.version_'+v.plugin_identifier).append('<span class="layui-badge layui-bg-red pointer_style" lay-event="update">新版本</span>');
                            if(v.details){
                                $('.version_'+v.plugin_identifier).append('<span class="layui-badge layui-bg-gray pointer_style" lay-event="details">查看</span>');   
                            }
                        });
                        
                    }
                });
                return false;
                    
            }

            $('.codeImage').on('click', function () {
                switchCaptcha();
            });
            

            // 刷新表格数据
            window.refreshTable = function () {
                nprogress.start();
                table.reloadData("data-table", {
                    scrollPos: "fixed",
                    done: function (res, curr) {
                        nprogress.done();
                        if (curr > 1 && res.data && !res.data.length) {
                            curr = curr - 1;
                            table.reloadData("data-table", {
                                page: {
                                    curr: curr
                                },
                            })
                        }
                        let thisOptions = this; 
                        if(thisOptions.installedtype=='installed'){
                            getversion(res.data);
                        } 
                    }
                });
            }
        })

    </script>

    <!-- 表格顶部工具栏 -->
    <script type="text/html" id="table-toolbar">
        <div class="layui-btn-group plugin_btn">
            <button type="button" class="layui-btn layui-btn-sm {{= d.installedtype =='installed' ? '' : 'layui-btn-plugin' }}" lay-event="installed">已经安装</button>
            <button type="button" class="layui-btn layui-btn-sm {{= d.installedtype =='waitapps' ? '' : 'layui-btn-plugin' }}" lay-event="waitapps">在线安装</button>
            <button type="button" class="layui-btn layui-btn-sm {{= d.installedtype =='localapps' ? '' : 'layui-btn-plugin' }}" lay-event="localapps">本地安装</button>
        </div>
    </script>

    <!-- 表格行工具栏 -->
    <script type="text/html" id="table-bar">
        {{# if(d.installed == '1'){ }}
        <div class="layui-btn-container">
        
            <button type="button" class="layui-btn layui-btn-xs" lay-event="edit">
                <i class="layui-icon layui-icon-set-sm"></i>配置
            </button>
            <button type="button" class="layui-btn layui-btn-xs layui-bg-red" lay-event="remove">
                <i class="layui-icon layui-icon-delete"></i>卸载
            </button>
        
        </div>
        {{# }else{ }}
        <button class="layui-btn layui-btn-xs" lay-event="installed">安装应用</button>
        {{# } }}
    </script>
    <script type="text/html" id="html-dom-reg">
        <div class="layui-form" lay-filter="filter-reg-layer" style="margin: 16px;">
            <div class="demo-reg-container">
                <div class="layui-form-item">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-cellphone"></i>
                        </div>
                        <input type="text" name="username" value="" lay-verify="required|phone" placeholder="手机号" lay-reqtext="请填写手机号" autocomplete="off" class="layui-input" id="reg-cellphone">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-password"></i>
                        </div>
                        <input type="password" name="password" value="" lay-verify="required" placeholder="密码" autocomplete="off" class="layui-input" id="reg-password" lay-affix="eye">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-password"></i>
                        </div>
                        <input type="password" name="confirmPassword" value="" lay-verify="required|confirmPassword" placeholder="确认密码" autocomplete="off" class="layui-input" lay-affix="eye">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-username"></i>
                        </div>
                        <input type="text" name="nickname" value="" lay-verify="required|nickname" placeholder="昵称" autocomplete="off" class="layui-input" lay-affix="clear">

                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-row">
                    <div class="layui-col-xs7">
                        <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                            <i class="layui-icon layui-icon-vercode"></i>
                        </div>
                        <input type="text" name="captcha" value="" lay-verify="required" placeholder="验证码" lay-reqtext="请填写验证码" autocomplete="off" class="layui-input" lay-affix="clear">
                        </div>
                    </div>
                    <div class="layui-col-xs5">
                        <div style="margin-left: 10px;">
                        <img class="codeImage" width="100%" height="38" lay-on="refreshCaptcha">
                        </div>
                    </div>
                    </div>
                </div> 
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-reg">注册</button>
                </div>
                <div class="layui-form-item demo-reg-other" style="float:right;">
                    <a href="JavaScript:;" lay-on="login">登录帐号</a>
                </div>
            </div>
        </div>
    </script>
    <script type="text/html" id="html-dom-login">
        <div class="layui-form" lay-filter="filter-login-layer" style="margin: 16px;">
            <div class="demo-login-container">
            <div class="layui-form-item">
                <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-username"></i>
                </div>
                <input type="text" name="username" value="" lay-verify="required" placeholder="用户名" lay-reqtext="请填写用户名" autocomplete="off" class="layui-input" lay-affix="clear">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="password" value="" lay-verify="required" placeholder="密   码" lay-reqtext="请填写密码" autocomplete="off" class="layui-input" lay-affix="eye">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-row">
                <div class="layui-col-xs7">
                    <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-vercode"></i>
                    </div>
                    <input type="text" name="captcha" value="" lay-verify="required" placeholder="验证码" lay-reqtext="请填写验证码" autocomplete="off" class="layui-input" lay-affix="clear">
                    </div>
                </div>
                <div class="layui-col-xs5">
                    <div style="margin-left: 10px;">
                        <img class="codeImage" width="100%" height="38" lay-on="refreshCaptcha">
                    </div>
                </div>
                </div>
            </div> 
            <div class="layui-form-item">
                <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-login">登录</button>
            </div>
            <div class="layui-form-item demo-login-other" style="float:right;">
                <a href="JavaScript:;" lay-on="reg">注册帐号</a></span>
            </div>
            </div>
        </div>
    </script>
    <script type="text/html" id="html-dom-wnyun">
        <div class="layui-form" lay-filter="filter-login-layer" style="margin: 16px;">
            <div class="demo-login-container">
                <div class="layui-form-item">
                    <fieldset class="layui-elem-field layui-field-box-fie">
                        <div class="layui-field-box">
                            <p>用户:{{= d.username }}</p>
                            <p>姓名:{{= d.nickname }}</p>
                        </div>
                        <div class="layui-field-box-img">
                            <img src="/app/webniu/skins/admin/images/avatar.png" width="70" height="70" />
                        </div>
                    </fieldset>
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-fluid" lay-submit lay-on="out">退出登录</button>
                </div> 
            </div>
        </div>
    </script>
</body>

</html>