<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<meta charset="utf-8">
	<title>控制台</title>
	<link rel="stylesheet" href="/app/webniu/skins/component/pear/css/pear.css" />
	<link rel="stylesheet" href="/app/webniu/skins/admin/css/admin.css" />
	<link rel="stylesheet" href="/app/webniu/skins/admin/css/variables.css" />
	<link rel="stylesheet" href="/app/webniu/skins/admin/css/reset.css" />
	<link rel="stylesheet" href="/app/webniu/skins/component/pear/module/apexcharts/apexcharts.css" />
	<link rel="stylesheet" href="/app/webniu/skins/admin/css/dashboard.css" />
</head>

<body>
	<div class="pear-container">
		<div class="layui-row layui-col-space10">
			<div class="layui-col-xs6 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-body">
						<div class="layui-row layui-dash-height-100">
							<div class="layui-col-xs6 layui-col-md9">
								<div class="layui-dash-font-ms">
									User View
								</div>
								<div class="layui-font-diy-01" id="value1">
									0
								</div>
								<div class="layui-dash-font-cl">
									<span class="layui-table-checked" style="border-radius:15px;"><i
											class="layui-icon layui-icon-about pear-this"
											style="font-size: 12px;"></i></span> 总注册会员用户
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-md3">
								<div class="layui-dash-wh layui-table-checked">
									<i class="layui-icon layui-icon-group pear-this"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-body">
						<div class="layui-row layui-dash-height-100">
							<div class="layui-col-xs6 layui-col-md9">
								<div class="layui-dash-font-ms">
									Manage View
								</div>
								<div class="layui-font-diy-01" id="value2">
									0
								</div>
								<div class="layui-dash-font-cl">
									<span class="layui-table-checked" style="border-radius:15px;"><i
											class="layui-icon layui-icon-about pear-this"
											style="font-size: 12px;"></i></span> 总注册管理用户
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-md3">
								<div class="layui-dash-wh layui-table-checked">
									<i class="layui-icon layui-icon-friends pear-this"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-body">
						<div class="layui-row layui-dash-height-100">
							<div class="layui-col-xs6 layui-col-md9">
								<div class="layui-dash-font-ms">
									Page View
								</div>
								<div class="layui-font-diy-01" id="value3">
									0
								</div>
								<div class="layui-dash-font-cl">
									<span class="layui-table-checked" style="border-radius:15px;"><i
											class="layui-icon layui-icon-about pear-this"
											style="font-size: 12px;"></i></span> 总浏览量
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-md3">
								<div class="layui-dash-wh layui-table-checked">
									<i class="layui-icon layui-icon-chart-screen pear-this"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-body">
						<div class="layui-row layui-dash-height-100">
							<div class="layui-col-xs6 layui-col-md9">
								<div class="layui-dash-font-ms">
									Plugin View
								</div>
								<div class="layui-font-diy-01" id="value4">
									0
								</div>
								<div class="layui-dash-font-cl">
									<span class="layui-table-checked" style="border-radius:15px;"><i
											class="layui-icon layui-icon-about pear-this"
											style="font-size: 12px;"></i></span> 已安装应用
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-md3">
								<div class="layui-dash-wh layui-table-checked">
									<i class="layui-icon layui-icon-app pear-this"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="layui-row layui-col-space10">
			<div class="layui-col-xs12 layui-col-md9">
				<div class="layui-card top-panel">
					<div class="layui-card-body layui-height-300">
						<div class="echarts-records" id="bar"></div>
					</div>
				</div>
			</div>
			<div class="layui-col-xs12 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-body layui-height-300">
						<div class="echarts-records" id="donut"></div>
					</div>
				</div>
			</div>
		</div>

		<div class="layui-row layui-col-space10">
			<div class="layui-col-xs12 layui-col-md9">
				<div class="layui-card top-panel">
					<div class="layui-card-header layui-text-style">日志信息</div>
					<div class="layui-card-body" style="height: 300px; overflow: hidden;">
						<table id="data-table" lay-filter="data-table"></table>
					</div>
				</div>
			</div>
			<div class="layui-col-xs12 layui-col-md3">
				<div class="layui-card top-panel">
					<div class="layui-card-header layui-text-style">软件信息</div>
					<div class="layui-card-body" style="height:300px;">
						<div class="layui-row">
							<table lay-filter="parse-table-demo">
								<thead>
									<tr>
										<th lay-data="{field:'name',style:'height:41px'}">名称</th>
										<th lay-data="{field:'nation',style:'height:41px'}">版本号</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>Workerman版本</td>
										<td>{$workerman_version}</td>
									</tr>
									<tr>
										<td>Webman版本</td>
										<td>{$webman_version}</td>
									</tr>
									<tr>
										<td>Webniu版本</td>
										<td>{$admin_version}</td>
									</tr>
									<tr>
										<td>PHP版本</td>
										<td>{$php_version}</td>
									</tr>
									<tr>
										<td>MYSQL版本</td>
										<td>{$mysql_version}</td>
									</tr>
									<tr>
										<td>操作系统</td>
										<td>{$os}</td>
									</tr>
								</tbody>
							</table>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="/app/webniu/skins/component/layui/layui.js"></script>
	<script src="/app/webniu/skins/component/pear/pear.js"></script>
	<script src="/app/webniu/skins/admin/js/permission.js"></script>
	<script src="/app/webniu/skins/admin/js/common.js"></script>

	<script src="/app/webniu/skins/component/pear/module/apexcharts/apexcharts.js"></script>
	<script>

		 
		// 表格渲染
		layui.use(["table", "form", "common", "popup", "util", "count", "nprogress", "element"], function () {
			let table = layui.table;
			let nprogress = parent.layui.nprogress;
			let form = layui.form;
			let $ = layui.$;
			let common = layui.common;
			let element = layui.element;
			let util = layui.util;
			let count = layui.count;
			element.on('tabBeforeChange(content)', function (data) {
				if (data.to.id == window.PearAdmin.configurationCache.tab.index.id) {
					table.reload('data-table');
				}
			});
			table.init('parse-table-demo', {
				// height: ''
			});
			window.dashboard = function(){
				//刷新当前页
				location.reload();
			}
			let color = localStorage.getItem("theme-color-color");
			let sparkColor = color == null ? '#008FFB' : color;
			layui.colorPalette = [sparkColor];
			nprogress.start();
			$.ajax({
				url: "/app/webniu/web/index/readata",
				dataType: "json",
				success: function (res) {
					nprogress.done();
					count.up("value1", {
						time: 4000,
						num: res.data.user_count,
						bit: 0,
						regulator: 50
					});
					count.up("value2", {
						time: 4000,
						num: res.data.admin_count,
						bit: 0,
						regulator: 50
					});
					count.up("value3", {
						time: 4000,
						num: res.data.stat_count,
						bit: 0,
						regulator: 50
					});
					count.up("value4", {
						time: 4000,
						num: res.data.plugin_count,
						bit: 0,
						regulator: 50
					});
					var donut = new ApexCharts(document.querySelector("#donut"), {
						series: res.data.plugin.series,
						chart: {
							width: '100%',
							height: '100%',
							type: 'pie',
						},
						labels: res.data.plugin.labels,
						theme: {
							monochrome: {
								enabled: true,
								color: sparkColor,
							},
						},
						plotOptions: {
							pie: {
								dataLabels: {
									offset: -5,
								},
							},
						},
						grid: {
							padding: {
								top: 0,
								bottom: 0,
								left: 0,
								right: 0,
							},
						},
						dataLabels: {
							formatter(val, opts) {
								let size = res.data.plugin.size[opts.seriesIndex];
								let labels = res.data.plugin.labels[opts.seriesIndex];
								return [labels, `已安装 ${size}`];
							},
						},
						legend: {
							show: false,
						},
					}).render();

					

					let bar = new ApexCharts(document.getElementById("bar"), {
						chart: {
							type: "area",
							fontFamily: "inherit",
							height: 300,
							parentHeightOffset: 0,
							toolbar: {
								show: false,
							},
							animations: {
								enabled: false,
							},
							stacked: true,
							zoom: {
								enabled: false // 禁用缩放功能
							}
						},
						plotOptions: {
							bar: {
								columnWidth: "50%",
							},
						},
						dataLabels: {
							enabled: false,
						},
						fill: {
							opacity: 1,
						},
						series: [
							{
								name: "后台访问量",
								data: res.data.day15_detail.series,
							}
						],
						grid: {
							padding: {
								top: 0,
								right: 0,
								left: 0,
								bottom: 0,
							},
							strokeDashArray: 4,
							xaxis: {
								lines: {
									show: false,
								},
							},
							yaxis: {
								lines: {
									show: false,
								},
							},
						},
						xaxis: {
							labels: {
								offsetX: 0,
								offsetY: 0,
							},
							tooltip: {
								enabled: false,
							}
						},
						yaxis: {
							labels: {
								padding: 13,
							},
							tooltip: {
								enabled: false,
							}
						},
						labels: res.data.day15_detail.labels,
						colors: layui.colorPalette,
						legend: {
							show: false,
						},
						stroke: {
							show: true,
							width: 2,
						},
						title: {
							text: '访问量',
							align: 'left',
							style: {
								fontSize: '18px',
								color: "#6c757d"
							}
						}
					}).render();
				}
			});

			function render() {
				let cols = [
					{
						type: "checkbox",
						hide: true,
					}, {
						title: "主键",
						field: "id",
						hide: true,
					}, {
						title: "账号",
						field: "username",
					}, {
						title: "昵称",
						field: "nickname",
					}, {
						title: "IP",
						field: "user_ip",
					}, {
						title: "代理",
						field: "user_agent",
					}, {
						title: "操作系统",
						field: "user_os",
					}, {
						title: "浏览器",
						field: "user_browser",
					}, {
						title: "日志信息",
						field: "error",
					}, {
						title: "日志状态",
						field: "status",
						templet: function (d) {
							if (d.status == '1') {
								return '正常';
							} else {
								return '错误';
							}

						}
					}, {
						title: "日志时间",
						field: "created_at",
					}
				];

				table.render({
					elem: "#data-table",
					url: "/app/webniu/web/logtime/select",
					page: true,
					cols: [cols],
					skin: "line",
					size: "lg",
					toolbar: false,
					autoSort: false,
					limit: 4,
					defaultToolbar: [{
						title: "刷新",
						layEvent: "refresh",
						icon: "layui-icon-refresh",
					}],
					done: function () {

					}
				});
			}

			render();
			window.onresize = function () {
			}
		})

	</script>
	<script type="text/html" id="table-toolbar">
		<div class="layui-text-style">日志信息</div>
	</script>
</body>

</html>